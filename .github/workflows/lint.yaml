name: Lint Master
on:
  pull_request:
    branches:
      - master

jobs:
  format-code:
    runs-on: ubuntu-latest

    steps:
      - name: obtain-source
        uses: actions/checkout@v1
      - name: new-branch
        env:
          hash_value: ${{ github.sha }}
        run: git checkout -b ${hash_value}-#pr
      - name: get-lint-settings
        run:  wget https://raw.githubusercontent.com/NWChemEx-Project/DeveloperTools/master/ci/lint/clang-format.in -O .clang-format
      - name: get-clang-format
        run: |
              sudo apt update
              sudo apt-get install -f clang-format-9
      - name: run-clang-format
        run: |
              find utilities -name '*.hpp' -or -name '*.cpp' | xargs clang-format-9 -style=file -i -fallback-style=none
      - name: commit-changes
        run: |
              diff_value=`git diff`
              if [ -z "$diff_value" ]
              then
                  echo "NO CHANGES"
              else
                  git config --local user.email "action@github.com"
                  git config --local user.name "GitHub Action"
                  git commit -m "linted source" -a
                  echo "CHANGES"
              fi
      - name: Dump steps context
        env:
          STEPS_CONTEXT: ${{ toJson(steps) }}
        run: echo "$STEPS_CONTEXT"
#      - name: push-changes
#        if: steps.commit-changes.outputs.
#        uses: ad-m/github-push-action@master
#        with:
#          github_token: ${{ secrets.GITHUB_TOKEN }}
#          branch: ${{ github.sha }}-#pr
#      - name: Create PR
#        uses: funivan/github-autopr@0.2.0
#        env:
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#        with:
#          args: .head_commit.message .*#pr.*


