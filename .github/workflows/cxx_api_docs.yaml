name: Build CXX API Documentation
on:
  pull_request:
    branches:
      - master

jobs:
  format-code:
    runs-on: ubuntu-latest

    steps:
      - name: Obtain Source
        uses: actions/checkout@v2
      - name: Get CMake
        env:
          cmake_url: https://github.com/Kitware/CMake/releases/download
          cmake_version: 3.16.3
          arch: Linux-x86_64
        run: |
              wget ${cmake_url}/v${cmake_version}/cmake-${cmake_version}-${arch}.sh
              yes | /bin/sh cmake-${cmake_version}-${arch}.sh
      - name: Get Doxygen
        run: |
              sudo apt update
              sudo apt-get install -f doxygen
      - name: Build Documentation
        env:
          cmake_version: 3.16.3
          arch: Linux-x86_64
        run: |
              cmake-${cmake_version}-${arch}/bin/cmake -H. -Bbuild
              cmake-${cmake_version}-${arch}/bin/cmake --build build --target cxx_api
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          personal_token: ${{ secrets.CREATE_PULL_REQUEST_TOKEN }}
          publish_dir: ./build/html


